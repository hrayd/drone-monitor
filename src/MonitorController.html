<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>无人机模拟器</title>
</head>
<body>
<h1>
    本页面为无人机模拟控制页面
</h1>
<h3>
    请先确保监控系统与本控制页面都已成功建立连接，当前状态：
    <span id="status" style="color:red">未连接</span>
    <button id="btn">连接</button>
</h3>
<p>按下p键新增无人机，按下x键清空无人机，使用方向键控制无人机方向。</p>
<p>请通过单击键盘控制，长按无效。</p>
<script>
  let ws = null;
  const btn = document.getElementById("btn");
  const status = document.getElementById("status");
  btn.onclick = function() {
    console.log(btn);
    if (ws) {
      ws.close();
      ws = null;
      status.innerHTML = "未连接";
      status.style = "color:red";
      btn.innerHTML = "连接";
    } else {
      ws = new WebSocket("ws://localhost:5050/broadcast");
      ws.onopen = function() {
        console.log("连接成功");
        status.innerHTML = "已连接";
        status.style = "color:green";
        btn.innerHTML = "断开";
      };
      ws.onerror = function(e) {
        console.log("连接错误：", e)
      };
      ws.onclose = function() {
        console.log("连接关闭");
        status.innerHTML = "未连接";
        status.style = "color:red";
      };
      ws.onmessage = function(e) {
        console.log("RECEIVE: ", e.data);
      };
    }
  }

  // 键盘事件
  document.addEventListener('keydown', (event) => {
    const keyName = event.key;
    console.log("PRESS: ", keyName);
  }, false);

  document.addEventListener('keyup', (event) => {
    const keyName = event.key;
    if(ws) {
      switch(keyName) {
        case 'ArrowUp': {
          ws.send("up");
          break;
        }
        case 'ArrowDown': {
          console.log("下");
          ws.send("down");
          break;
        }
        case 'ArrowLeft': {
          console.log("左");
          ws.send("left");
          break;
        }
        case 'ArrowRight': {
          console.log("右");
          ws.send("right");
          break;
        }
        case 'p': {
          console.log("p");
          ws.send("add");
          break;
        }
        case 'x': {
          console.log("x");
          ws.send("clear");
          break;
        }
        default: break;
      }
    }
  }, false);
</script>
</body>
</html>